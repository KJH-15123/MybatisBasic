<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- namespace : 해당 mapper파일의 고유한 별칭(호출할때 매퍼 지정하기 위한 역할) -->
<mapper namespace="memberMapper">

	<!-- 
		*DML 구문일 경우
		<insert id="각 sql구문의 식별자(key)" parameterType ="전달받은데이터타입 혹은 별칭">
			수행할 sql구문
		</insert>
		
		*parameterType은 전달받은 데이터가 없다면 생략가능
		= parameterType을 입력하지 않아도 mybatis가 자동주문을 하기 때문에 생략 가능하지만
		  명확하게 작성하기 위해 입력
		
		만약 클래스 타입이라면 풀 클래스명을 입력해야 한다. ex)com.kh.mybatis.model.vo.Member
		너무 길기 때문에 작성하기 어렵다면 별칭(alias)를 부여하여 짧게 사용할 수 있다.
		
		*SELECT 구문일 경우 resultType 또는 resultMap 을 이용하여 결과값에 대한 타입을 지정한다.
		SELECT 구문의 경우 조회값이 있기 때문에 해당 타입 지정은 필수요소이다.
		
		<select id="구문식별자(key)" parameterType="전달받은 데이터타입 또는 별칭"
				resultType="결과반환타입" 또는 resultMap="조회결과를 매핑할 resultMap의 id값">
			실행할 sql 구문
		</select>
		
		공통적으로 전달받은 parameter(전달값)가 있으면 ? 처럼 위치홀더가 아닌 #{키값}을 이용하여 데이터를 넣어준다.
		이때 #{키값}의 키는 전달받은 변수명,객체필드명,map의 키값등이 된다.
		만약 조회된 결과집합을 resultType을 이용하여 사용자 정의된 VO에 담고자 한다면
		조회된 컬럼명과 VO의 필드명이 일치해야한다. 필드명이 일치하지 않는 경우엔 설정 또는
		resultMap을 이용한다.
		
		*resultMap
		마이바티스의 핵심 기능중 하나로 ResultSet으로 부터 조회된 컬럼값을 하나씩 추출하여
		내가 지정한 VO객체 필드에 담아주는(매핑) JDBC 코드를 줄요주는 역할을 수행한다.
		
		<resultMap id="식별자" type="해당 resultMap을 이용하여 담아줄 VO타입">
			<result column ="조회결과를 추출할 컬럼명" property="해당 결과를 담을 VO필드명/>
			<result column ="조회결과를 추출할 컬럼명" property="해당 결과를 담을 VO필드명/>
			<result column ="조회결과를 추출할 컬럼명" property="해당 결과를 담을 VO필드명/>
			...
		</resultMap>
		*resultMap에 작성한 컬럼을 전부 조회하지 않아도 문제없고 result 태그 순서도 상관없다.
	 -->
	 
	 <!-- 로그인 구문 -->
	 
	 <select id="loginMember" parameterType="com.kh.mybatis.member.model.vo.Member"
	 		resultType="com.kh.mybatis.member.model.vo.Member">
		SELECT	 USER_NO	userNo
				,USER_ID	userId
				,USER_PWD	userPwd
				,USER_NAME	userName
				,EMAIL
				,BIRTHDAY
				,GENDER
				,PHONE
				,ADDRESS
				,ENROLL_DATE	enrollDate
				,MODIFY_DATE	modifyDate
				,STATUS
		FROM MEMBER
		WHERE USER_ID = #{userId}
		AND USER_PWD = #{userPwd}
		AND STATUS = 'Y'
	 </select>
	 
	 <!-- 회원가입 구문 -->
	 <insert id="insertMember" parameterType="Member">
	 INSERT INTO MEMBER(
			USER_NO
			,USER_ID
			,USER_PWD
			,USER_NAME
			,EMAIL
			,BIRTHDAY
			,GENDER
			,PHONE
			,ADDRESS
			,ENROLL_DATE
			,MODIFY_DATE
			,STATUS
		)
		VALUES
		(
			SEQ_UNO.NEXTVAL
			,#{userId}
			,#{userPwd}
			,#{userName}
			,#{email}
			,#{birthday}
			,#{gender}
			,#{phone}
			,#{address}
			,SYSDATE
			,SYSDATE
			,'Y'
		)
	 </insert>
	 
	 <!-- 업데이트 구문 -->
	 <update id="updateMember" parameterType="Member">
	 UPDATE MEMBER
	 SET
	 	EMAIL = #{email}
	 	,BIRTHDAY = #{birthday}
	 	,GENDER =#{gender}
	 	,PHONE =#{phone}
	 	,ADDRESS =#{address}
	 	,USER_NAME =#{userName}
	 	,MODIFY_DATE = SYSDATE
	 WHERE
	 	USER_ID = #{userId}
	 	AND STATUS = 'Y'
	 </update>



	<!-- 정보 조회 구문 -->
	<!--  아래 resultMap 활용 -->
	<select id="selectMember" parameterType="Member" resultMap="memberResultMap">
	SELECT	 USER_NO
				,USER_ID
				,USER_PWD
				,USER_NAME
				,EMAIL
				,BIRTHDAY
				,GENDER
				,PHONE
				,ADDRESS
				,ENROLL_DATE
				,MODIFY_DATE
				,STATUS
	FROM MEMBER
	WHERE USER_ID=#{userId}
	AND STATUS='Y'
	</select>
	
	<!-- 
		resultMap 정의하기
		type : resultMap이 반환할 타입 / id: resultMap의 이름(고유)
		result-column : 테이블 컬럼명 / property: 반환타입 VO의 필드명
		
		목적 : 데이터베이스의 칼럼명과 자바 객체(VO)의 변수명이 다를 때, 둘을 연결해주는 지도(Map)역할
	-->
	<resultMap type="Member" id="memberResultMap">
		<result column ="USER_NO" property="userNo"/>
		<result column ="USER_ID" property="userId"/>
		<result column ="USER_PWD" property="userPwd"/>
		<result column ="USER_NAME" property="userName"/>
		<result column ="EMAIL" property="email"/>
		<result column ="BIRTHDAY" property="birthday"/>
		<result column ="GENDER" property="gender"/>
		<result column ="PHONE" property="phone"/>
		<result column ="ADDRESS" property="address"/>
		<result column ="ENROLL_DATE" property="enrollDate"/>
		<result column ="MODIFY_DATE" property="modifyDate"/>
		<result column ="STATUS" property="status"/>
		
	</resultMap>
	


</mapper>